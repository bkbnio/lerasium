package io.bkbn.lerasium.generated.persistence.entity

import io.bkbn.lerasium.core.model.Entity
import io.bkbn.lerasium.generated.models.BookReviewResponse
import java.util.UUID
import kotlin.Int
import kotlin.reflect.full.memberProperties
import kotlin.reflect.full.valueParameters
import kotlinx.datetime.LocalDateTime
import org.jetbrains.exposed.dao.UUIDEntity
import org.jetbrains.exposed.dao.UUIDEntityClass
import org.jetbrains.exposed.dao.id.EntityID
import org.jetbrains.exposed.dao.id.UUIDTable
import org.jetbrains.exposed.sql.Column
import org.jetbrains.exposed.sql.kotlin.datetime.datetime

public object BookReviewTable : UUIDTable("book_review") {
  public val reader: Column<EntityID<UUID>> = reference("reader", UserTable)

  public val book: Column<EntityID<UUID>> = reference("book", BookTable)

  public val rating: Column<Int> = integer("rating")

  public val createdAt: Column<LocalDateTime> = datetime("created_at")

  public val updatedAt: Column<LocalDateTime> = datetime("updated_at")
}

public class BookReviewEntity(
  id: EntityID<UUID>,
) : UUIDEntity(id), Entity<BookReviewResponse> {
  public var reader: UserEntity by UserEntity referencedOn BookReviewTable.reader

  public var book: BookEntity by BookEntity referencedOn BookReviewTable.book

  public var rating: Int by BookReviewTable.rating

  public var createdAt: LocalDateTime by BookReviewTable.createdAt

  public var updatedAt: LocalDateTime by BookReviewTable.updatedAt

  public override fun toResponse(): BookReviewResponse = with(::BookReviewResponse) {
    val propertiesByName = BookReviewEntity::class.memberProperties.associateBy { it.name }
    val params = valueParameters.associateWith {
      when (it.name) {
        BookReviewResponse::id.name -> id.value
        BookReviewEntity::reader.name -> reader.toResponse()
        BookReviewEntity::book.name -> book.toResponse()
        else -> propertiesByName[it.name]?.get(this@BookReviewEntity)
      }
    }
    callBy(params)
  }

  public companion object : UUIDEntityClass<BookReviewEntity>(BookReviewTable)
}
